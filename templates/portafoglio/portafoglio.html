{% extends "header.html"%}
{% block title %}Home Page{% endblock %}
{% block content %}

<style>
  .dropdown {
  margin: 20px;
}

html,
body{
    height: 100%;
    overflow: hidden;
}

.cont{
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.dropdown-menu {
  max-height: 20rem;
}
</style>
<div class="cont">
  <div id="menu" class="dropdown-menu" aria-labelledby="dropdown_coins" style="position: inherit; display: block; overflow: hidden;"><!-- Da sistemare questo inherit-->
    <form class="px-4 py-2">
        <input type="search" class="form-control" id="searchCoin" placeholder="Ragione Sociale" autofocus="autofocus" value="">
    </form>
    <div id="menuItems" style="overflow: auto;">
        {% for cliente in clienti%}
          <input type="button" class="dropdown-item" type="button" value='{{cliente.ragioneSociale}}'/>
        {% endfor %}
    </div>
    <div id="empty" class="dropdown-header">Nessun nome trovato</div>
</div>

</div>

<script>
//If it does show the symbol, else hide it
function filter(word) {
    let length = items.length
    let collection = []
    let hidden = 0
    for (let i = 0; i < length; i++) {
    if (items[i].value.toLowerCase().startsWith(word)) {
        $(items[i]).show()
    }
    else {
        $(items[i]).hide()
        hidden++
    }
    }

    //If all items are hidden, show the empty view
    if (hidden === length) {
    $('#empty').show()
    }
    else {
    $('#empty').hide()
    }
}

$('#menuItems').on('click', function(){
  console.log("dentro 2")
    $(this).show()

})

//If the user clicks on any item, set the title of the button as the text of the item
$('.dropdown-item').on('click', function(){
  console.log("premo dentro")
  console.log($(this)[0].value)
    $('#searchCoin').value= ($(this)[0].value)
    //$("#dropdown_coins").dropdown('toggle');
    $('#menuItems').hide()
})
$('#menu').show()
</script>

    <script>
    $(document).ready(function(){
      $("#searchCoin").on("keyup", function() {
        console.log($(this)[0].value);
        var val = $(this)[0].value.toLowerCase();
        $("#menuItems input").filter(function() {
          $(this).toggle($(this)[0].value.toLowerCase().indexOf(val) > -1)
        });
      });
    });

    
    </script>

    <!--<input class="form-control" id="myInput" type="text" placeholder="Cerca per un qualsiasi valore">
    <table class="table table-dark">
        <thead>
            <tr>
                <th>
                    <th scope="col">RagioneSociale</th>
                    <th scope="col">Fisso</th>
                    <th scope="col">Mobile</th>
                    <th scope="col">Totale</th>
                    <th scope="col">Trattative</th>
                    <th scope="col">Altre informazioni</th>
                </th>
            </tr>
        </thead>
        <tbody id="myTable">
            {% for cliente in clienti %}
            <tr>
                <th scope="row">i</th>
                <td>{{ cliente.ragioneSociale}} </td>
                <td>{% if cliente.fisso %} {{ cliente.fisso}} {% else %} 0.0 {%endif%}</td>
                <td>{% if cliente.mobile %} {{ cliente.mobile}} {% else %} 0.0 {%endif%}</td>
                <td>{% if cliente.totale %} {{ cliente.totale}} {% else %} 0.0 {%endif%}</td>
                <form action="/portafoglio/getTrattativa", method="get">
                    <input type="number" name="appello" id="appello" value="{{cliente.idPortafoglio}}" hidden>
                    <td><button type="submit" class ="btn btn-danger">Apri trattative</button></td>
                </form>
                <td><button>Premi qui</button></td>

            </tr>
            {% endfor %}
        </tbody>
    </table>-->

    {% if trattative%}

    <table class="table table-dark">
      <thead>
          <tr>
              <th>
                  <th scope="col">Fisso</th>
                  <th scope="col">Mobile</th>
                  <th scope="col">Totale</th>
                  <th scope="col">Stato</th>
                  <th scope="col">dataChiusura</th>
                  <th scope="col">Altre informazioni</th>
              </th>
          </tr>
      </thead>
      <tbody id="myTable">
        {% for trattativa in trattative%}
          <tr>
              <td>{% if trattativa.fisso %} {{ trattativa.fisso}} {% else %} 0.0 {%endif%}</td>
              <td>{% if trattativa.mobile %} {{ trattativa.mobile}} {% else %} 0.0 {%endif%}</td>
              <td>{% if trattativa.totale %} {{ trattativa.totale}} {% else %} 0.0 {%endif%}</td>
              <td>{% if trattativa.dataChiusura %} {{trattativa.dataChiusura}} {%else%} Data non presente {%endif%}</td>
              <form action="/portafoglio/getTrattativa", method="get">
                  <input type="number" name="appello" id="appello" value="{{cliente.idPortafoglio}}" hidden>
                  <td><button type="submit" class ="btn btn-danger">Apri trattative</button></td>
              </form>
              <td><button>Premi qui</button></td>

          </tr>
        {% endfor %}
      </tbody>
  </table>

   

  {%endif%}



  

   <script>
    dropContainer.ondragover = dropContainer.ondragenter = function(evt) {
  evt.preventDefault();
};

dropContainer.ondrop = function(evt) {
  // pretty simple -- but not for IE :(
  fileInput.files = evt.dataTransfer.files;

  // If you want to use some of the dropped files
  const dT = new DataTransfer();
  dT.items.add(evt.dataTransfer.files[0]);
  dT.items.add(evt.dataTransfer.files[3]);
  fileInput.files = dT.files;

  evt.preventDefault();
};
   </script>

    <!--<p> Ciao, inserisci nuove trattative</p>
    <form action="/portafoglio/addTrattativa" method="post" enctype="multipart/form-data">
        <div id="dropContainer" style="border:1px solid black;height:100px;">
          Drop Here
      </div>
        Should update here:
        <input type="file" name="file"
            accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
        <input type="submit" value="Upload">
    </form>-->
  
{% endblock %}